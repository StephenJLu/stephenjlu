import{r,j as k}from"./components-BRXnhjxE.js";const L=r.createContext(null),O=typeof document<"u",j=O?r.useLayoutEffect:r.useEffect;class K{constructor(){this.order=[],this.scheduled=new Set}add(e){if(!this.scheduled.has(e))return this.scheduled.add(e),this.order.push(e),!0}remove(e){const t=this.order.indexOf(e);t!==-1&&(this.order.splice(t,1),this.scheduled.delete(e))}clear(){this.order.length=0,this.scheduled.clear()}}function H(n){let e=new K,t=new K,s=0,o=!1,i=!1;const a=new WeakSet,f={schedule:(l,d=!1,u=!1)=>{const c=u&&o,p=c?e:t;return d&&a.add(l),p.add(l)&&c&&o&&(s=e.order.length),l},cancel:l=>{t.remove(l),a.delete(l)},process:l=>{if(o){i=!0;return}if(o=!0,[e,t]=[t,e],t.clear(),s=e.order.length,s)for(let d=0;d<s;d++){const u=e.order[d];a.has(u)&&(f.schedule(u),n()),u(l)}o=!1,i&&(i=!1,f.process(l))}};return f}const w=["prepare","read","update","preRender","render","postRender"],U=40;function q(n,e){let t=!1,s=!0;const o={delta:0,timestamp:0,isProcessing:!1},i=w.reduce((c,p)=>(c[p]=H(()=>t=!0),c),{}),a=c=>{i[c].process(o)},f=()=>{const c=performance.now();t=!1,o.delta=s?1e3/60:Math.max(Math.min(c-o.timestamp,U),1),o.timestamp=c,o.isProcessing=!0,w.forEach(a),o.isProcessing=!1,t&&e&&(s=!1,n(f))},l=()=>{t=!0,s=!0,o.isProcessing||n(f)};return{schedule:w.reduce((c,p)=>{const R=i[p];return c[p]=(C,x=!1,M=!1)=>(t||l(),R.schedule(C,x,M)),c},{}),cancel:c=>w.forEach(p=>i[p].cancel(c)),state:o,steps:i}}const A=r.createContext({});function D(n){const e=r.useRef(null);return e.current===null&&(e.current=n()),e.current}const N=n=>n,{schedule:Q,cancel:se,state:ce,steps:oe}=q(typeof requestAnimationFrame<"u"?requestAnimationFrame:N,!0);function W(){const n=r.useContext(L);if(n===null)return[!0,null];const{isPresent:e,onExitComplete:t,register:s}=n,o=r.useId();return r.useEffect(()=>s(o),[]),!e&&t?[!1,()=>t&&t(o)]:[!0]}const S={current:null},$={current:!1};function G(){if($.current=!0,!!O)if(window.matchMedia){const n=window.matchMedia("(prefers-reduced-motion)"),e=()=>S.current=n.matches;n.addListener(e),e()}else S.current=!1}function b(){const n=r.useRef(!1);return j(()=>(n.current=!0,()=>{n.current=!1}),[]),n}function V(){const n=b(),[e,t]=r.useState(0),s=r.useCallback(()=>{n.current&&t(e+1)},[e]);return[r.useCallback(()=>Q.postRender(s),[s]),e]}class _ extends r.Component{getSnapshotBeforeUpdate(e){const t=this.props.childRef.current;if(t&&e.isPresent&&!this.props.isPresent){const s=this.props.sizeRef.current;s.height=t.offsetHeight||0,s.width=t.offsetWidth||0,s.top=t.offsetTop,s.left=t.offsetLeft}return null}componentDidUpdate(){}render(){return this.props.children}}function J({children:n,isPresent:e}){const t=r.useId(),s=r.useRef(null),o=r.useRef({width:0,height:0,top:0,left:0});return r.useInsertionEffect(()=>{const{width:i,height:a,top:f,left:l}=o.current;if(e||!s.current||!i||!a)return;s.current.dataset.motionPopId=t;const d=document.createElement("style");return document.head.appendChild(d),d.sheet&&d.sheet.insertRule(`
          [data-motion-pop-id="${t}"] {
            position: absolute !important;
            width: ${i}px !important;
            height: ${a}px !important;
            top: ${f}px !important;
            left: ${l}px !important;
          }
        `),()=>{document.head.removeChild(d)}},[e]),r.createElement(_,{isPresent:e,childRef:s,sizeRef:o},r.cloneElement(n,{ref:s}))}const v=({children:n,initial:e,isPresent:t,onExitComplete:s,custom:o,presenceAffectsLayout:i,mode:a})=>{const f=D(X),l=r.useId(),d=r.useMemo(()=>({id:l,initial:e,isPresent:t,custom:o,onExitComplete:u=>{f.set(u,!0);for(const c of f.values())if(!c)return;s&&s()},register:u=>(f.set(u,!1),()=>f.delete(u))}),i?void 0:[t]);return r.useMemo(()=>{f.forEach((u,c)=>f.set(c,!1))},[t]),r.useEffect(()=>{!t&&!f.size&&s&&s()},[t]),a==="popLayout"&&(n=r.createElement(J,{isPresent:t},n)),r.createElement(L.Provider,{value:d},n)};function X(){return new Map}function Y(n){return r.useEffect(()=>()=>n(),[])}const y=n=>n.key||"";function Z(n,e){n.forEach(t=>{const s=y(t);e.set(s,t)})}function ee(n){const e=[];return r.Children.forEach(n,t=>{r.isValidElement(t)&&e.push(t)}),e}const te=({children:n,custom:e,initial:t=!0,onExitComplete:s,exitBeforeEnter:o,presenceAffectsLayout:i=!0,mode:a="sync"})=>{const f=r.useContext(A).forceRender||V()[0],l=b(),d=ee(n);let u=d;const c=r.useRef(new Map).current,p=r.useRef(u),R=r.useRef(new Map).current,C=r.useRef(!0);if(j(()=>{C.current=!1,Z(d,R),p.current=u}),Y(()=>{C.current=!0,R.clear(),c.clear()}),C.current)return r.createElement(r.Fragment,null,u.map(h=>r.createElement(v,{key:y(h),isPresent:!0,initial:t?void 0:!1,presenceAffectsLayout:i,mode:a},h)));u=[...u];const x=p.current.map(y),M=d.map(y),F=x.length;for(let h=0;h<F;h++){const m=x[h];M.indexOf(m)===-1&&!c.has(m)&&c.set(m,void 0)}return a==="wait"&&c.size&&(u=[]),c.forEach((h,m)=>{if(M.indexOf(m)!==-1)return;const E=R.get(m);if(!E)return;const P=x.indexOf(m);let g=h;if(!g){const B=()=>{c.delete(m);const z=Array.from(R.keys()).filter(T=>!M.includes(T));if(z.forEach(T=>R.delete(T)),p.current=d.filter(T=>{const I=y(T);return I===m||z.includes(I)}),!c.size){if(l.current===!1)return;f(),s&&s()}};g=r.createElement(v,{key:y(E),isPresent:!1,onExitComplete:B,custom:e,presenceAffectsLayout:i,mode:a},E),c.set(m,g)}u.splice(P,0,g)}),u=u.map(h=>{const m=h.key;return c.has(m)?h:r.createElement(v,{key:y(h),isPresent:!0,presenceAffectsLayout:i,mode:a},h)}),r.createElement(r.Fragment,null,c.size?u:u.map(h=>r.cloneElement(h)))};function ue(){!$.current&&G();const[n]=r.useState(S.current);return n}const ie=({children:n,in:e,unmount:t,initial:s=!0,...o})=>{const i=r.useRef(),a=r.useRef();return r.useEffect(()=>{clearTimeout(e?a.current:i.current)},[e]),k.jsx(te,{children:(e||!t)&&k.jsx(re,{enterTimeout:i,exitTimeout:a,in:e,initial:s,...o,children:n})})},re=({children:n,timeout:e=0,enterTimeout:t,exitTimeout:s,onEnter:o,onEntered:i,onExit:a,onExited:f,initial:l,nodeRef:d,in:u})=>{const[c,p]=r.useState(l?"exited":"entered"),[R,C]=W(),[x,M]=r.useState(!l),F=typeof e=="object",h=r.useRef(null),m=d||h,E=x&&u?R:!1;return r.useEffect(()=>{var g;if(x||!u)return;const P=F?e.enter:e;clearTimeout(t.current),clearTimeout(s.current),M(!0),p("entering"),o==null||o(),(g=m.current)==null||g.offsetHeight,t.current=setTimeout(()=>{p("entered"),i==null||i()},P)},[o,i,e,c,u]),r.useEffect(()=>{var g;if(R&&u)return;const P=F?e.exit:e;clearTimeout(t.current),clearTimeout(s.current),p("exiting"),a==null||a(),(g=m.current)==null||g.offsetHeight,s.current=setTimeout(()=>{p("exited"),C==null||C(),f==null||f()},P)},[R,a,C,e,f,u]),n({visible:E,status:c,nodeRef:m})};export{ie as T,Q as a,D as b,se as c,j as d,ce as f,N as n,ue as u};
